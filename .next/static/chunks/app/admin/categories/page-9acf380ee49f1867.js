(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4331],{4302:function(e,t,a){Promise.resolve().then(a.bind(a,1285))},1285:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(3827),s=a(4090),i=a(4958),l=a(94),n=a(8670),d=a(4067),c=a(7731),o=a(489),m=a(703),x=a(2235),h=a(632);function u(e){let{value:t,onChange:a,disabled:i}=e,[l,n]=(0,s.useState)(!1),d=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r)try{n(!0);let e=new FormData;e.append("file",r);let t=await fetch("/api/upload",{method:"POST",body:e});if(!t.ok)throw Error("Upload failed");let s=await t.json();a(s.url)}catch(e){console.error("Error uploading image:",e)}finally{n(!1)}};return(0,r.jsx)("div",{className:"flex items-center gap-4",children:t?(0,r.jsxs)("div",{className:"relative w-32 h-32",children:[(0,r.jsx)(m.default,{src:t,alt:"Uploaded image",fill:!0,className:"object-cover rounded-lg"}),!i&&(0,r.jsx)("button",{onClick:()=>{a("")},className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:(0,r.jsx)(x.Z,{className:"w-4 h-4"})})]}):(0,r.jsxs)("label",{className:"flex flex-col items-center justify-center w-32 h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-gray-400 transition-colors",children:[(0,r.jsx)(h.Z,{className:"w-8 h-8 text-gray-400"}),(0,r.jsx)("span",{className:"mt-2 text-sm text-gray-500",children:"Upload ảnh"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:d,disabled:i||l,className:"hidden"})]})})}var p=a(2111);function g(){let[e,t]=(0,s.useState)([]),[a,x]=(0,s.useState)(!0),[h,g]=(0,s.useState)(""),[f,y]=(0,s.useState)(!1),[b,j]=(0,s.useState)(null),[N,w]=(0,s.useState)({name:"",description:"",slug:"",image_url:""}),[v,k]=(0,s.useState)(!1),[C,_]=(0,s.useState)(!1),[S,T]=(0,s.useState)({name:"",description:"",image_url:""});(0,s.useEffect)(()=>{E()},[]);let E=async()=>{try{let{data:e,error:a}=await i.O.from("categories").select("*").order("display_order",{ascending:!0});if(a)throw a;let r=e.map((e,t)=>({...e,display_order:e.display_order||t+1}));t(r)}catch(e){console.error("Error fetching categories:",e)}finally{x(!1)}},O=async a=>{if(a.preventDefault(),b)try{let{error:a}=await i.O.from("categories").update({name:b.name,description:b.description,slug:b.slug||b.name.toLowerCase().replace(/\s+/g,"-"),image_url:b.image_url}).eq("id",b.id);if(a)throw a;t(e.map(e=>e.id===b.id?b:e)),k(!1),j(null)}catch(e){console.error("Error updating category:",e)}},P=async a=>{if(confirm("Bạn c\xf3 chắc chắn muốn x\xf3a danh mục n\xe0y?"))try{let{error:r}=await i.O.from("categories").delete().eq("id",a);if(r)throw r;t(e.filter(e=>e.id!==a))}catch(e){console.error("Error deleting category:",e)}},Z=async a=>{if(!a.destination)return;let r=Array.from(e),[s]=r.splice(a.source.index,1);r.splice(a.destination.index,0,s),t(r);try{let e=r.map((e,t)=>({id:e.id,display_order:t+1}));if(!(await fetch("/api/categories/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:e})})).ok)throw Error("Failed to update category order");await E()}catch(e){console.error("Error updating category order:",e),await E()}},D=async a=>{a.preventDefault();try{if(b){if(!(await fetch("/api/categories/".concat(b.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)})).ok)throw Error("Failed to update category");t(e.map(e=>e.id===b.id?{...e,...S}:e))}else{let a=await fetch("/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)});if(!a.ok)throw Error("Failed to create category");let r=await a.json();t([...e,r])}_(!1),j(null),T({name:"",description:"",image_url:""})}catch(e){console.error("Error saving category:",e)}},L=e=>{j(e),T({name:e.name,description:e.description,image_url:e.image_url}),_(!0)},q=e.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.description.toLowerCase().includes(h.toLowerCase()));return a?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"})}):(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Quản l\xfd danh mục"}),(0,r.jsxs)("button",{onClick:()=>{j(null),T({name:"",description:"",image_url:""}),_(!0)},className:"flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),"Th\xeam danh mục"]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"T\xecm kiếm danh mục...",value:h,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg"}),(0,r.jsx)(n.Z,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,r.jsx)(p.Z5,{onDragEnd:Z,children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,r.jsx)("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thứ tự"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ảnh"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"T\xean danh mục"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"M\xf4 tả"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Slug"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thao t\xe1c"})]})}),(0,r.jsx)(p.bK,{droppableId:"categories",children:e=>(0,r.jsxs)("tbody",{...e.droppableProps,ref:e.innerRef,className:"bg-white divide-y divide-gray-200",children:[q.map((e,t)=>(0,r.jsx)(p._l,{draggableId:e.id,index:t,children:(t,a)=>(0,r.jsxs)("tr",{ref:t.innerRef,...t.draggableProps,className:"hover:bg-gray-50 ".concat(a.isDragging?"bg-gray-100":""),children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{...t.dragHandleProps,className:"cursor-move",children:(0,r.jsx)(d.Z,{className:"w-5 h-5 text-gray-400"})})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"relative w-16 h-16",children:(0,r.jsx)(m.default,{src:e.image_url||"/images/placeholder.png",alt:e.name,fill:!0,className:"object-cover rounded-lg"})})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"font-medium text-gray-900",children:e.name})}),(0,r.jsx)("td",{className:"px-6 py-4",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.description})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("div",{className:"text-sm text-gray-500",children:e.slug})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,r.jsx)("button",{onClick:()=>L(e),className:"text-indigo-600 hover:text-indigo-900 mr-4",children:(0,r.jsx)(c.Z,{className:"w-5 h-5"})}),(0,r.jsx)("button",{onClick:()=>P(e.id),className:"text-red-600 hover:text-red-900",children:(0,r.jsx)(o.Z,{className:"w-5 h-5"})})]})]})},e.id)),e.placeholder]})})]})})}),C&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:b?"Chỉnh sửa danh mục":"Th\xeam danh mục mới"}),(0,r.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T\xean danh mục"}),(0,r.jsx)("input",{type:"text",required:!0,value:S.name,onChange:e=>T({...S,name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M\xf4 tả"}),(0,r.jsx)("textarea",{rows:3,value:S.description,onChange:e=>T({...S,description:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ảnh danh mục"}),(0,r.jsx)(u,{value:S.image_url,onChange:e=>T({...S,image_url:e})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>_(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:"Hủy"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:b?"Cập nhật":"Th\xeam mới"})]})]})]})}),v&&b&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center mt-0",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-md mx-4",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b",children:(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Cập nhật danh mục"})}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("form",{onSubmit:O,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"T\xean danh mục"}),(0,r.jsx)("input",{type:"text",value:b.name,onChange:e=>j({...b,name:e.target.value}),className:"mt-1 block w-full border rounded-md px-3 py-2",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"M\xf4 tả"}),(0,r.jsx)("textarea",{value:b.description||"",onChange:e=>j({...b,description:e.target.value}),className:"mt-1 block w-full border rounded-md px-3 py-2",rows:3})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Ảnh danh mục"}),(0,r.jsx)(u,{value:b.image_url,onChange:e=>j({...b,image_url:e})})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{k(!1),j(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Hủy"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Cập nhật"})]})]})})]})})]})}},4958:function(e,t,a){"use strict";a.d(t,{O:function(){return r}});let r=(0,a(8714).createClientComponentClient)()}},function(e){e.O(0,[1216,8714,703,5179,2971,8069,1744],function(){return e(e.s=4302)}),_N_E=e.O()}]);