(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8606],{7634:function(e,t,s){Promise.resolve().then(s.bind(s,5900))},5900:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var a=s(3827),r=s(4090),n=s(4958),l=s(8670),c=s(8435),i=s(1226);function d(){let[e,t]=(0,r.useState)([]),[s,d]=(0,r.useState)(!0),[o,h]=(0,r.useState)(""),[x,u]=(0,r.useState)("all");(0,r.useEffect)(()=>{p();let e=n.O.channel("orders_changes").on("postgres_changes",{event:"*",schema:"public",table:"orders"},e=>{console.log("Order changed:",e),p()}).subscribe();return()=>{e.unsubscribe()}},[]);let p=async()=>{try{let{data:e,error:s}=await n.O.from("orders").select("\n          *,\n          order_items (\n            id,\n            quantity,\n            price,\n            product:products (\n              name,\n              price\n            )\n          )\n        ").order("created_at",{ascending:!1});if(s)throw s;console.log("Fetched orders:",e),t(e||[])}catch(e){console.error("Error fetching orders:",e)}finally{d(!1)}},m=async(s,a)=>{try{let r=await fetch("/api/orders/update-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:s,status:a})});if(!r.ok)throw Error("Failed to update order status");let n=await r.json();n.success&&t(e.map(e=>e.id===s?n.order:e))}catch(e){console.error("Error updating order status:",e),alert("Failed to update order status")}},g=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},y=e=>{switch(e){case"paid":return"text-green-600";case"pending":return"text-yellow-600";case"failed":return"text-red-600";default:return"text-gray-600"}},f=e=>{switch(e){case"paid":return"Đ\xe3 thanh to\xe1n";case"pending":return"Chờ thanh to\xe1n";case"failed":return"Thanh to\xe1n thất bại";default:return e}},j=e.filter(e=>{let t=e.customer_name.toLowerCase().includes(o.toLowerCase())||e.id.toLowerCase().includes(o.toLowerCase()),s="all"===x||e.status===x;return t&&s});return s?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-600"})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Quản l\xfd đơn h\xe0ng"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"T\xecm kiếm đơn h\xe0ng...",value:o,onChange:e=>h(e.target.value),className:"pl-10 pr-4 py-2 border rounded-lg w-64"}),(0,a.jsx)(l.Z,{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5"})]}),(0,a.jsxs)("select",{value:x,onChange:e=>u(e.target.value),className:"border rounded-lg px-4 py-2",children:[(0,a.jsx)("option",{value:"all",children:"Tất cả trạng th\xe1i"}),(0,a.jsx)("option",{value:"pending",children:"Chờ xử l\xfd"}),(0,a.jsx)("option",{value:"processing",children:"Đang xử l\xfd"}),(0,a.jsx)("option",{value:"completed",children:"Ho\xe0n th\xe0nh"}),(0,a.jsx)("option",{value:"cancelled",children:"Đ\xe3 hủy"})]})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"M\xe3 đơn h\xe0ng"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ng\xe0y đặt"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Kh\xe1ch h\xe0ng"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tổng tiền"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trạng th\xe1i"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thanh to\xe1n"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["#",e.id.slice(0,8)]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,c.WU)(new Date(e.created_at),"dd/MM/yyyy HH:mm",{locale:i.vi})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(0,a.jsx)("div",{children:e.customer_name}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.customer_email}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:e.customer_phone})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e.total_amount)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("select",{value:e.status,onChange:t=>m(e.id,t.target.value),className:"px-2 py-1 rounded-full text-sm font-medium ".concat(g(e.status)),children:[(0,a.jsx)("option",{value:"pending",children:"Chờ xử l\xfd"}),(0,a.jsx)("option",{value:"processing",children:"Đang xử l\xfd"}),(0,a.jsx)("option",{value:"shipping",children:"Đang giao h\xe0ng"}),(0,a.jsx)("option",{value:"completed",children:"Ho\xe0n th\xe0nh"}),(0,a.jsx)("option",{value:"cancelled",children:"Đ\xe3 hủy"})]})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[(0,a.jsx)("div",{children:"vnpay"===e.payment_method?"VNPay":"Thanh to\xe1n khi nhận h\xe0ng"}),(0,a.jsx)("div",{className:"text-xs ".concat(y(e.payment_status)),children:f(e.payment_status)})]})]},e.id))})]})})]})}},4958:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(8714).createClientComponentClient)()}},function(e){e.O(0,[8714,3965,2971,8069,1744],function(){return e(e.s=7634)}),_N_E=e.O()}]);