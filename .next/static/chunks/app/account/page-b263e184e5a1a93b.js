(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9346],{9495:function(e,t,r){Promise.resolve().then(r.bind(r,4559))},7977:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var s=r(4090);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let i=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:i=2,absoluteStrokeWidth:c,className:d="",children:o,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:t,...n,width:a,height:a,stroke:r,strokeWidth:c?24*Number(i)/Number(a):i,className:l("lucide",d),...m},[...u.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(o)?o:[o]])}),c=(e,t)=>{let r=(0,s.forwardRef)((r,n)=>{let{className:c,...d}=r;return(0,s.createElement)(i,{ref:n,iconNode:t,className:l("lucide-".concat(a(e)),c),...d})});return r.displayName="".concat(e),r}},3118:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(7977).Z)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]])},527:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(7977).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},5211:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(7977).Z)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]])},9910:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(7977).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2600:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(7977).Z)("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]])},7907:function(e,t,r){"use strict";var s=r(5313);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},4559:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var s=r(3827),a=r(3118),l=r(2600),n=r(527),i=r(5211),c=r(9910),d=r(4090),o=r(4958),u=r(7907),m=r(8792);function x(){let e=(0,u.useRouter)(),[t,r]=(0,d.useState)(null),[x,h]=(0,d.useState)(null),[g,p]=(0,d.useState)(!0),[f,y]=(0,d.useState)(!1),[b,j]=(0,d.useState)(null),[N,v]=(0,d.useState)(null),[w,k]=(0,d.useState)(null),[S,_]=(0,d.useState)("profile");(0,d.useEffect)(()=>{o.O.auth.getSession().then(t=>{let{data:{session:s}}=t;if(!s){e.push("/login");return}r(s.user),Z(s.user.id),p(!1)});let{data:{subscription:t}}=o.O.auth.onAuthStateChange((t,s)=>{if(!s){e.push("/login");return}r(s.user),Z(s.user.id),p(!1)});return()=>t.unsubscribe()},[e]);let Z=async e=>{try{console.log("Fetching profile for user ID:",e);let{data:{session:r},error:s}=await o.O.auth.getSession();if(s){console.error("Session error:",s);return}if(!r){console.error("No session found");return}let{data:a,error:l}=await o.O.from("users").select("*").eq("email",r.user.email).single();if(l&&"PGRST116"!==l.code){console.error("Error checking existing user:",l);return}if(a){console.log("Found existing user:",a),h(a);return}let{data:n,error:i}=await o.O.from("users").select("id, full_name, email, phone, points, role, address, avatar_url").eq("id",e).maybeSingle();if(i){console.error("Database error:",i);return}if(console.log("Fetched user data:",n),n)h({id:n.id,full_name:n.full_name,email:n.email,phone:n.phone,points:n.points,role:n.role,address:n.address,avatar_url:n.avatar_url||null});else{var t;let{data:s,error:a}=await o.O.from("users").insert([{id:e,full_name:(null===(t=r.user.user_metadata)||void 0===t?void 0:t.full_name)||"",email:r.user.email,phone:"",points:0,role:"customer",password_hash:r.user.aud||"",address:""}]).select().single();if(a){console.error("Error creating profile:",a);return}console.log("Created new profile:",s),h(s)}}catch(e){console.error("Error in fetchUserProfile:",e)}},C=async e=>{e.preventDefault(),y(!0),j(null);let r=new FormData(e.currentTarget),s=r.get("full_name"),a=r.get("phone"),l=r.get("address");try{console.log("Updating profile with:",{full_name:s,phone:a,address:l});let{data:e,error:r}=await o.O.from("users").update({full_name:s,phone:a,address:l,avatar_url:w||(null==x?void 0:x.avatar_url)||null,updated_at:new Date().toISOString()}).eq("email",t.email).select().single();if(r)throw console.error("Update error:",r),r;console.log("Update successful:",e),h(e=>e?{...e,full_name:s,phone:a,address:l,avatar_url:w||(null==x?void 0:x.avatar_url)||null}:null),j({type:"success",text:"Cập nhật th\xf4ng tin th\xe0nh c\xf4ng!"})}catch(e){console.error("Error updating profile:",e),j({type:"error",text:e.message||"C\xf3 lỗi xảy ra khi cập nhật th\xf4ng tin"})}finally{y(!1)}};return g?(0,s.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"animate-pulse",children:[(0,s.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-8"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-4"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),(0,s.jsxs)("div",{className:"md:col-span-3 bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]})]})]})}):(0,s.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 mb-8",children:[(0,s.jsx)("a",{href:"/",className:"hover:text-red-600",children:"Trang chủ"}),(0,s.jsx)("span",{children:"/"}),(0,s.jsx)("span",{className:"text-gray-400",children:"T\xe0i khoản"})]}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"T\xe0i khoản"}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-8",children:[(0,s.jsxs)("div",{className:"w-full md:w-64 space-y-1",children:[(0,s.jsxs)(m.default,{href:"/account",className:"flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-50 ".concat("profile"===S?"bg-gray-50 text-red-600":"text-gray-700"),children:[(0,s.jsx)(a.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Th\xf4ng tin t\xe0i khoản"})]}),(0,s.jsxs)(m.default,{href:"/orders",className:"flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-50 ".concat("orders"===S?"bg-gray-50 text-red-600":"text-gray-700"),children:[(0,s.jsx)(l.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Đơn h\xe0ng của t\xf4i"})]}),(0,s.jsxs)(m.default,{href:"/payment",className:"flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-50 ".concat("payment"===S?"bg-gray-50 text-red-600":"text-gray-700"),children:[(0,s.jsx)(n.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Phương thức thanh to\xe1n"})]}),(0,s.jsxs)(m.default,{href:"/favorites",className:"flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-50 ".concat("favorites"===S?"bg-gray-50 text-red-600":"text-gray-700"),children:[(0,s.jsx)(i.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Sản phẩm y\xeau th\xedch"})]}),(0,s.jsxs)(m.default,{href:"/settings",className:"flex items-center space-x-2 p-3 rounded-lg hover:bg-gray-50 ".concat("settings"===S?"bg-gray-50 text-red-600":"text-gray-700"),children:[(0,s.jsx)(c.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"C\xe0i đặt"})]})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Th\xf4ng tin t\xe0i khoản"}),b&&(0,s.jsx)("div",{className:"mb-4 p-4 rounded-lg ".concat("success"===b.type?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:b.text}),(0,s.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Họ v\xe0 t\xean"}),(0,s.jsx)("input",{type:"text",name:"full_name",defaultValue:(null==x?void 0:x.full_name)||"",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Số điện thoại"}),(0,s.jsx)("input",{type:"tel",name:"phone",defaultValue:(null==x?void 0:x.phone)||"",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,s.jsx)("input",{type:"email",value:(null==x?void 0:x.email)||"",disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Địa chỉ"}),(0,s.jsx)("textarea",{defaultValue:(null==x?void 0:x.address)||"",name:"address",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent"})]}),(0,s.jsx)("button",{type:"submit",disabled:f,className:"px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:f?"Đang cập nhật...":"Cập nhật th\xf4ng tin"})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Đơn h\xe0ng gần đ\xe2y"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-600",children:"M\xe3 đơn h\xe0ng"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-600",children:"Ng\xe0y đặt"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-600",children:"Tổng tiền"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-600",children:"Trạng th\xe1i"}),(0,s.jsx)("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-600",children:"Thao t\xe1c"})]})}),(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:"#DH001"}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:"01/01/2024"}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:"2.999.000đ"}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium text-green-800 bg-green-100 rounded-full",children:"Đ\xe3 giao h\xe0ng"})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("a",{href:"#",className:"text-sm text-red-600 hover:text-red-700",children:"Xem chi tiết"})})]}),(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:"#DH002"}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:"02/01/2024"}),(0,s.jsx)("td",{className:"py-3 px-4 text-sm",children:"1.499.000đ"}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("span",{className:"px-2 py-1 text-xs font-medium text-yellow-800 bg-yellow-100 rounded-full",children:"Đang xử l\xfd"})}),(0,s.jsx)("td",{className:"py-3 px-4",children:(0,s.jsx)("a",{href:"#",className:"text-sm text-red-600 hover:text-red-700",children:"Xem chi tiết"})})]})]})]})})]})]})]})]})}},4958:function(e,t,r){"use strict";r.d(t,{O:function(){return s}});let s=(0,r(8714).createClientComponentClient)()}},function(e){e.O(0,[8714,8792,2971,8069,1744],function(){return e(e.s=9495)}),_N_E=e.O()}]);