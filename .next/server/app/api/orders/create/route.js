"use strict";(()=>{var r={};r.id=9426,r.ids=[9426],r.modules={517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:r=>{r.exports=require("buffer")},6113:r=>{r.exports=require("crypto")},2361:r=>{r.exports=require("events")},3685:r=>{r.exports=require("http")},5687:r=>{r.exports=require("https")},1808:r=>{r.exports=require("net")},5477:r=>{r.exports=require("punycode")},2781:r=>{r.exports=require("stream")},4404:r=>{r.exports=require("tls")},7310:r=>{r.exports=require("url")},9796:r=>{r.exports=require("zlib")},9515:(r,e,t)=>{t.r(e),t.d(e,{headerHooks:()=>g,originalPathname:()=>f,patchFetch:()=>q,requestAsyncStorage:()=>c,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>m});var o={};t.r(o),t.d(o,{POST:()=>p});var s=t(5419),i=t(9108),n=t(9678),a=t(8070),u=t(6517);async function p(r){try{let{customer_name:e,customer_email:t,customer_phone:o,shipping_address:s,items:i,total_amount:n,payment_method:p="cod",notes:d}=await r.json();if(!e||!o||!s||!i||!n)return a.Z.json({error:"Vui l\xf2ng điền đầy đủ th\xf4ng tin"},{status:400});if(t&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return a.Z.json({error:"Email kh\xf4ng hợp lệ"},{status:400});if(!/^[0-9]{10}$/.test(o))return a.Z.json({error:"Số điện thoại kh\xf4ng hợp lệ"},{status:400});if(!Array.isArray(i)||0===i.length)return a.Z.json({error:"Giỏ h\xe0ng trống"},{status:400});if(n<=0)return a.Z.json({error:"Tổng tiền kh\xf4ng hợp lệ"},{status:400});let{data:c,error:l}=await u.O.from("orders").insert({customer_name:e,customer_email:t,customer_phone:o,shipping_address:s,total_amount:n,payment_method:p,payment_status:"pending",status:"pending",notes:d}).select().single();if(l)return console.error("Error creating order:",l),a.Z.json({error:"Lỗi khi tạo đơn h\xe0ng"},{status:500});let h=i.map(r=>({order_id:c.id,product_id:r.id,quantity:r.quantity,price:r.price})),{error:g}=await u.O.from("order_items").insert(h);if(g)return console.error("Error creating order items:",g),await u.O.from("orders").delete().eq("id",c.id),a.Z.json({error:"Lỗi khi tạo chi tiết đơn h\xe0ng"},{status:500});return a.Z.json({success:!0,order:c,message:"Đặt h\xe0ng th\xe0nh c\xf4ng",redirect:`/order-success?orderId=${c.id}`})}catch(r){return console.error("Error creating order:",r),a.Z.json({error:"Lỗi server"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/orders/create/route",pathname:"/api/orders/create",filename:"route",bundlePath:"app/api/orders/create/route"},resolvedPagePath:"C:\\Users\\dngvieth_23\\OneDrive\\Desktop\\local-shop\\src\\app\\api\\orders\\create\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:h,headerHooks:g,staticGenerationBailout:m}=d,f="/api/orders/create/route";function q(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:l})}},6517:(r,e,t)=>{t.d(e,{O:()=>o});let o=(0,t(7699).createClientComponentClient)()}};var e=require("../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),o=e.X(0,[1638,6206,7699],()=>t(9515));module.exports=o})();