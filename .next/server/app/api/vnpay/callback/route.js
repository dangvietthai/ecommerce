"use strict";(()=>{var e={};e.id=2166,e.ids=[2166],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},6413:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>q,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>v,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var a={};t.r(a),t.d(a,{GET:()=>d,dynamic:()=>l});var o=t(5419),s=t(9108),n=t(9678),p=t(8070),i=t(6517),u=t(6113),c=t.n(u);let l="force-dynamic";async function d(e){try{let{searchParams:r}=new URL(e.url),t=Object.fromEntries(r.entries()),a=t.vnp_SecureHash;delete t.vnp_SecureHash,delete t.vnp_SecureHashType;let o=Object.keys(t).sort().reduce((e,r)=>(e[r]=t[r],e),{}),s=Object.entries(o).map(([e,r])=>`${e}=${r}`).join("&"),n=c().createHmac("sha512",process.env.VNPAY_HASH_SECRET||"").update(Buffer.from(s,"utf-8")).digest("hex");if(a!==n)return p.Z.json({error:"Invalid signature"},{status:400});let u=t.vnp_TxnRef,l=t.vnp_ResponseCode,d="00"===l?"paid":"failed",{error:v}=await i.O.from("orders").update({payment_status:d,status:"paid"===d?"processing":"pending"}).eq("id",u);if(v)return console.error("Error updating order:",v),p.Z.json({error:"Failed to update order"},{status:500});let h="paid"===d?`/order-success?orderId=${u}`:`/payment-result?vnp_ResponseCode=${l}`;return p.Z.redirect(new URL(h,e.url))}catch(e){return console.error("Error processing VNPay callback:",e),p.Z.json({error:"Internal server error"},{status:500})}}let v=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/vnpay/callback/route",pathname:"/api/vnpay/callback",filename:"route",bundlePath:"app/api/vnpay/callback/route"},resolvedPagePath:"C:\\Users\\dngvieth_23\\OneDrive\\Desktop\\local-shop\\src\\app\\api\\vnpay\\callback\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:x,headerHooks:f,staticGenerationBailout:y}=v,q="/api/vnpay/callback/route";function b(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},6517:(e,r,t)=>{t.d(r,{O:()=>a});let a=(0,t(7699).createClientComponentClient)()}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[1638,6206,7699],()=>t(6413));module.exports=a})();