"use strict";(()=>{var e={};e.id=1995,e.ids=[1995],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},298:(e,r,n)=>{n.r(r),n.d(r,{headerHooks:()=>m,originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>_,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>h});var t={};n.r(t),n.d(t,{POST:()=>v});var o=n(5419),a=n(9108),p=n(9678),s=n(8070),u=n(4868),i=n(6517);async function v(e){try{let{orderId:r,amount:n}=await e.json(),{data:t,error:o}=await i.O.from("orders").select("*").eq("id",r).single();if(o||!t)return s.Z.json({error:"Order not found"},{status:404});let a=new Date().getTime().toString(),p={vnp_Version:"2.1.0",vnp_Command:"pay",vnp_TmnCode:process.env.VNPAY_TMN_CODE||"",vnp_Locale:"vn",vnp_CurrCode:"VND",vnp_TxnRef:r,vnp_OrderInfo:`Thanh toan don hang ${t.order_number}`,vnp_OrderType:"other",vnp_Amount:100*n,vnp_ReturnUrl:process.env.VNPAY_RETURN_URL||"http://localhost:3000/payment/vnpay-return",vnp_CreateDate:a,vnp_IpAddr:"127.0.0.1"},v=(0,u.Wf)(p),{error:c}=await i.O.from("vnpay_transactions").insert({order_id:r,vnp_txn_ref:r,vnp_amount:n,vnp_command:"pay",vnp_create_date:a,vnp_curr_code:"VND",vnp_ip_addr:"127.0.0.1",vnp_locale:"vn",vnp_order_info:`Thanh toan don hang ${t.order_number}`,vnp_order_type:"other",vnp_return_url:process.env.VNPAY_RETURN_URL||"http://localhost:3000/payment/vnpay-return",vnp_tmn_code:process.env.VNPAY_TMN_CODE||"",vnp_version:"2.1.0",vnp_hash_secret:process.env.VNPAY_HASH_SECRET||"",vnp_url:process.env.VNPAY_URL||"https://sandbox.vnpayment.vn/paymentv2/vpcpay.html",status:"pending"});if(c)return console.error("Error creating VNPay transaction:",c),s.Z.json({error:"Failed to create transaction"},{status:500});return s.Z.json({paymentUrl:v})}catch(e){return console.error("Error processing payment:",e),s.Z.json({error:"Internal server error"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/payment/vnpay/route",pathname:"/api/payment/vnpay",filename:"route",bundlePath:"app/api/payment/vnpay/route"},resolvedPagePath:"C:\\Users\\dngvieth_23\\OneDrive\\Desktop\\local-shop\\src\\app\\api\\payment\\vnpay\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:_,staticGenerationAsyncStorage:d,serverHooks:l,headerHooks:m,staticGenerationBailout:h}=c,y="/api/payment/vnpay/route";function f(){return(0,p.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:d})}},6517:(e,r,n)=>{n.d(r,{O:()=>t});let t=(0,n(7699).createClientComponentClient)()},4868:(e,r,n)=>{n.d(r,{Wf:()=>p,tj:()=>s});var t=n(6113),o=n.n(t);let a={vnp_TmnCode:process.env.VNPAY_TMN_CODE||"",vnp_HashSecret:process.env.VNPAY_HASH_SECRET||"",vnp_Url:process.env.VNPAY_URL||"",vnp_ReturnUrl:process.env.VNPAY_RETURN_URL||""};function p(e){let r=Object.keys(e).sort().reduce((r,n)=>(r[n]=String(e[n]),r),{}),n=Object.entries(r).map(([e,r])=>`${e}=${encodeURIComponent(r)}`).join("&"),t=o().createHmac("sha512",a.vnp_HashSecret).update(Buffer.from(n,"utf-8")).digest("hex"),p=new URLSearchParams({...r,vnp_SecureHash:t});return`${a.vnp_Url}?${p.toString()}`}function s(e){let r=e.vnp_SecureHash;delete e.vnp_SecureHash,delete e.vnp_SecureHashType;let n=Object.entries(Object.keys(e).sort().reduce((r,n)=>(r[n]=e[n],r),{})).map(([e,r])=>`${e}=${encodeURIComponent(r)}`).join("&");return r===o().createHmac("sha512",a.vnp_HashSecret).update(Buffer.from(n,"utf-8")).digest("hex")}}};var r=require("../../../../webpack-runtime.js");r.C(e);var n=e=>r(r.s=e),t=r.X(0,[1638,6206,7699],()=>n(298));module.exports=t})();